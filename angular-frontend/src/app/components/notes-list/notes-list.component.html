<div class="notes-page">
  
  <!-- Top Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-gradient shadow-sm">
    <div class="container-fluid px-4">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <i class="bi bi-journal-text fs-3 me-2"></i>
        <span class="fw-bold">Notes App</span>
      </a>
      
      <div class="d-flex align-items-center gap-3">
        <!-- Theme Toggle -->
        <button class="btn btn-theme-toggle" (click)="toggleTheme()" title="Toggle theme">
          <i class="bi" [ngClass]="isDarkMode ? 'bi-sun-fill' : 'bi-moon-stars-fill'"></i>
        </button>
        
        <!-- Backend Badge -->
        <span class="badge bg-info">
          <i class="bi bi-server me-1"></i>
          {{ backendType === 'nodejs' ? 'Node.js' : 'Python' }}
        </span>
        
        <!-- User Dropdown -->
        <div class="dropdown">
          <button class="btn btn-user-menu dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-2"></i>
            <span class="d-none d-md-inline">{{ currentUser?.username }}</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li class="dropdown-header">
              <div class="d-flex align-items-center">
                <i class="bi bi-person-circle fs-3 me-2"></i>
                <div>
                  <div class="fw-bold">{{ currentUser?.username }}</div>
                  <small class="text-muted">{{ currentUser?.email || 'user@example.com' }}</small>
                </div>
              </div>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-palette me-2"></i>Preferences</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" (click)="logout()" style="cursor: pointer;">
              <i class="bi bi-box-arrow-right me-2"></i>Logout
            </a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container-fluid px-4 py-4">
    
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
          <div>
            <h1 class="display-6 fw-bold mb-1">
              <i class="bi bi-stickies me-2" style="color: #4f46e5;"></i>
              My Notes
            </h1>
            <p class="text-muted mb-0">
              <i class="bi bi-card-list me-1"></i>
              Organize your thoughts and ideas
            </p>
          </div>
          <button class="btn btn-primary btn-lg" (click)="createNote()">
            <i class="bi bi-plus-circle me-2"></i>New Note
          </button>
        </div>

        <!-- Stats Cards -->
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="stats-card primary">
              <div class="stats-icon">
                <i class="bi bi-journal-text"></i>
              </div>
              <h3>{{ notes.length }}</h3>
              <p>Total Notes</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stats-card success">
              <div class="stats-icon">
                <i class="bi bi-calendar-check"></i>
              </div>
              <h3>{{ getTodayNotesCount() }}</h3>
              <p>Created Today</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stats-card primary">
              <div class="stats-icon">
                <i class="bi bi-clock-history"></i>
              </div>
              <h3>{{ getRecentActivityCount() }}</h3>
              <p>This Week</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body p-3">
            <div class="row g-3 align-items-center">
              <div class="col-md-8">
                <div class="input-group input-group-lg">
                  <span class="input-group-text bg-white border-end-0">
                    <i class="bi bi-search text-muted"></i>
                  </span>
                  <input 
                    type="text" 
                    class="form-control border-start-0 ps-0" 
                    placeholder="Search notes by title or content..."
                    [(ngModel)]="searchTerm"
                  >
                  <button 
                    class="btn btn-outline-secondary" 
                    type="button"
                    *ngIf="searchTerm"
                    (click)="searchTerm = ''"
                  >
                    <i class="bi bi-x-lg"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-4 d-flex justify-content-end gap-2">
                <button 
                  class="btn btn-outline-primary" 
                  (click)="toggleViewMode()"
                  title="Toggle view mode"
                >
                  <i [class]="viewMode === 'grid' ? 'bi bi-list-ul' : 'bi bi-grid-3x3-gap'"></i>
                  {{ viewMode === 'grid' ? 'List' : 'Grid' }} View
                </button>
                <button 
                  class="btn btn-outline-secondary" 
                  (click)="loadNotes()"
                  title="Refresh notes"
                >
                  <i class="bi bi-arrow-clockwise"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-muted mt-3">Loading your notes...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger shadow-sm" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ error }}
      <button class="btn btn-sm btn-danger ms-3" (click)="loadNotes()">
        <i class="bi bi-arrow-clockwise me-1"></i>Retry
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && filteredNotes.length === 0 && !error" class="text-center py-5">
      <div class="empty-state-icon mb-4">
        <i class="bi bi-journal-x display-1 text-muted"></i>
      </div>
      <h3 class="text-muted mb-3">
        {{ searchTerm ? 'No notes found' : 'No notes yet' }}
      </h3>
      <p class="text-muted mb-4">
        {{ searchTerm ? 'Try a different search term' : 'Get started by creating your first note!' }}
      </p>
      <button class="btn btn-primary btn-lg" (click)="createNote()" *ngIf="!searchTerm">
        <i class="bi bi-plus-circle me-2"></i>Create Your First Note
      </button>
      <button class="btn btn-outline-secondary" (click)="searchTerm = ''" *ngIf="searchTerm">
        <i class="bi bi-x-circle me-2"></i>Clear Search
      </button>
    </div>

    <!-- Notes Grid View -->
    <div *ngIf="!loading && filteredNotes.length > 0 && viewMode === 'grid'" class="row g-4">
      <div *ngFor="let note of filteredNotes" class="col-md-6 col-lg-4">
        <div class="card note-card h-100 border-0 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title fw-bold mb-0 flex-grow-1">{{ note.title }}</h5>
              <div class="dropdown">
                <button class="btn btn-sm btn-link text-muted p-0" type="button" data-bs-toggle="dropdown">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" (click)="editNote(note.id!)" style="cursor: pointer;">
                      <i class="bi bi-pencil me-2"></i>Edit
                    </a>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <a class="dropdown-item text-danger" (click)="deleteNote(note)" style="cursor: pointer;">
                      <i class="bi bi-trash me-2"></i>Delete
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            
            <p class="card-text text-muted flex-grow-1 mb-3">
              {{ getTruncatedContent(note.content) }}
            </p>
            
            <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top">
              <small class="text-muted">
                <i class="bi bi-clock me-1"></i>
                {{ getTimeAgo(note.createdAt) }}
              </small>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" (click)="editNote(note.id!)">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="deleteNote(note)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notes List View -->
    <div *ngIf="!loading && filteredNotes.length > 0 && viewMode === 'list'" class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="list-group list-group-flush">
            <div *ngFor="let note of filteredNotes" class="list-group-item list-group-item-action note-list-item">
              <div class="d-flex w-100 justify-content-between align-items-start">
                <div class="flex-grow-1" (click)="editNote(note.id!)" style="cursor: pointer;">
                  <h5 class="mb-2 fw-bold">
                    <i class="bi bi-file-text text-primary me-2"></i>
                    {{ note.title }}
                  </h5>
                  <p class="mb-2 text-muted">{{ getTruncatedContent(note.content, 200) }}</p>
                  <small class="text-muted">
                    <i class="bi bi-clock me-1"></i>
                    {{ getTimeAgo(note.createdAt) }}
                  </small>
                </div>
                <div class="btn-group ms-3">
                  <button class="btn btn-sm btn-outline-primary" (click)="editNote(note.id!)">
                    <i class="bi bi-pencil me-1"></i>Edit
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteNote(note)">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
